{"version":3,"sources":["main.js"],"names":["app","BrowserWindow","ipcMain","protocol","systemPreferences","require","url","path","dialog","Store","marked","removeMarkdown","win","loginFlow","prefs","store","name","defaults","windowBounds","width","height","x","y","loginCredentials","server","username","password","appInterface","sidebar","selected","appSettings","sortby","orderby","zoom","cursor","spellcheck","exportPath","getPath","createWindow","get","theme","isDarkMode","saveWindowBounds","set","getBounds","show","titleBarStyle","minWidth","minHeight","backgroundColor","webPreferences","devTools","preload","join","__dirname","nodeIntegration","icon","setSheetOffset","loadURL","format","pathname","slashes","once","on","quit","registerFileProtocol","request","callback","split","user","replace","pass","close","webContents","send","reload","error","console","event","message","resizable","minimizable","maximizable","userAgent","extraHeaders"],"mappings":"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","file":"../main.min.js","sourcesContent":["'use strict'\n\nconst {app, BrowserWindow, ipcMain, protocol, systemPreferences} = require('electron')\nconst url = require('url') \nconst path = require('path')\nconst dialog = require('electron').dialog\nconst Store = require('electron-store')\n\nconst marked = require( 'marked' )\nconst removeMarkdown = require( 'remove-markdown' )\n\n\nlet win,\n\tloginFlow,\n\tprefs = null\n\n\n\nlet store = new Store({\n\tname: 'config',\n\tdefaults: {\n\t\t\n\t\twindowBounds: {\n\t\t\twidth: 800,\n\t\t\theight: 600,\n\t\t\tx: 0,\n\t\t\ty: 0\n\t\t},\n\t\t\n\t\tloginCredentials: {\n\t\t\t\n\t\t\tserver: '',\n\t\t\tusername: '',\n\t\t\tpassword: ''\n\t\t},\n\t\t\n\t\tappInterface: {\n\t\t\t\n\t\t\tsidebar: null,\n\t\t\tselected: null,\n\t\t},\n\t\t\n\t\tappSettings: {\n\t\t\t\n\t\t\tsortby: 'modified',\n\t\t\torderby: 'desc',\n\t\t\tzoom: '10',\n\t\t\tcursor: 'start',\n\t\t\tspellcheck: true\n\t\t\t\n\t\t},\n\t\t\n\t\texportPath: app.getPath('desktop')\n\t}\n})\n\n\n\nfunction createWindow() {\n\t\n\t\n\tlet { x, y, width, height } = store.get('windowBounds'),\n\t\ttheme = systemPreferences.isDarkMode() ? '#393837' : '#ededed'\n\t\n\twin = new BrowserWindow({\n\t\tshow: false,\n\t\tx: x,\n\t\ty: y,\n\t\twidth: width,\n\t\theight: height,\n\t\ttitleBarStyle: 'hidden',\n\t\tminWidth: 500,\n\t\tminHeight: 372,\n\t\tbackgroundColor: theme,\n\t\twebPreferences: {\n\t\t\tdevTools: false,\n\t\t\tpreload: path.join(__dirname, './preload.min.js'),\n\t\t\tnodeIntegration: true\n\t\t},\n\t\ticon: path.join(__dirname, '../assets/icon/Icon.icns')\n\t})\n\t\n\twin.setSheetOffset( 24 )\n\t\n\tfunction saveWindowBounds() {\n\t\t\n\t\tstore.set('windowBounds', win.getBounds())\n\t}\n\t\n\twin.loadURL(url.format ({ \n\t\t\n\t\tpathname: path.join(__dirname, '../html/app.html'), \n\t\tprotocol: 'file:', \n\t\tslashes: true \n\t}))\n\t\n\twin.once('ready-to-show', () => {\n\t\t\n\t\twin.show()\n\t})\n\t\n\twin.on('resize', saveWindowBounds)\n\twin.on('move', saveWindowBounds)\n\t\n\twin.on('closed', () => {\n\t\t\n\t\tapp.quit()\n\t})\n\t\n\trequire( './menu-app.min' )\n\trequire( './menu-sidebar.min' )\n\t\n\t\n\tprotocol.registerFileProtocol('nc', (request, callback) => {\n\t\t\n\t\tconst url = request.url.split( '&' )\n\t\t\n\t\tconst \tuser = url[1].replace('user:', ''),\n\t\t\t\tpass = url[2].replace('password:', '')\n\t\t\n\t\tstore.set( 'loginCredentials.username', user )\n\t\tstore.set( 'loginCredentials.password', pass )\n\t\t\n\t\tloginFlow.close()\n\t\t\n\t\twin.webContents.send('close-login-modal', 'close-login-modal')\n\t\twin.reload()\n\t\n\t}, (error) => {\n\t\n\t\tif (error) console.error('Failed to register protocol')\n\t})\n}\n\napp.on('ready', createWindow) \n\n\n\nipcMain.on('loginflow', (event, message) => {\n\t\n\tloginFlow = new BrowserWindow({\n\t\t\n\t\twidth: 800,\n\t\theight: 600,\n\t\tresizable: false,\n\t\tminimizable: false,\n\t\tmaximizable: false,\n\t\tshow: false,\n\t\ttitleBarStyle: 'hidden',\n\t\tbackgroundColor: '#0082c9',\n\t\twebPreferences: {\n\t\t\tdevTools: false,\n\t\t\tnodeIntegration: false\n\t\t}\n\t})\n\t\n\t\n\tloginFlow.loadURL( message + '/index.php/login/flow' , {\n\t\t\n\t\tuserAgent: 'Nextcloud Notes Client - Macintosh',\n\t\textraHeaders: 'OCS-APIRequest: true'\n\t})\n\t\n\t\n\tloginFlow.once('ready-to-show', () => {\n\t\t\n\t\tloginFlow.show()\n\t})\n})\n\n\n\napp.on('open-prefs', () => {\n\t\n\tif( prefs === null ) {\n\t\t\n\t\tlet theme = systemPreferences.isDarkMode() ? '#393837' : '#ededed'\n\t\t\n\t\tprefs = new BrowserWindow({\n\t\t\t\n\t\t\twidth: 548,\n\t\t\theight: 330,\n\t\t\tresizable: false,\n\t\t\tminimizable: false,\n\t\t\tmaximizable: false,\n\t\t\tshow: false,\n\t\t\tbackgroundColor: theme,\n\t\t\twebPreferences: {\n\t\t\t\tdevTools: false,\n\t\t\t\tpreload: path.join(__dirname, './preload.min.js'),\n\t\t\t\tnodeIntegration: true\n\t\t\t},\n\t\t})\n\t\t\n\t\t\n\t\tprefs.loadURL(url.format ({ \n\t\t\t\n\t\t\tpathname: path.join(__dirname, '../html/prefs.html'), \n\t\t\tprotocol: 'file:', \n\t\t\tslashes: true \n\t\t}))\n\t\t\n\t\t\n\t\tprefs.once('ready-to-show', () => {\n\t\t\t\n\t\t\tprefs.show()\n\t\t})\n\t\n\t\tprefs.on('close', () => {\n\t\t\tprefs = null\n\t\t})\n\t}\n})\n\n\n\nipcMain.on('reload-sidebar', () => {\n\t\n\twin.webContents.send('reload-sidebar', null)\t\n})\n\n\nipcMain.on('set-zoom-slider', (event, message) => {\n\t\n\twin.webContents.send('set-zoom-slider', message)\t\n})\n\n\nipcMain.on('spellcheck', (event, message) => {\n\t\n\twin.webContents.send('spellcheck', message)\t\n})\n"]}