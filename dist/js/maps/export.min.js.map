{"version":3,"sources":["export.js"],"names":["i18n","require","remote","Store","store","dialog","marked","removeMarkdown","pretty","fs","log","exports","exportNote","note","exportPath","get","showSaveDialog","getCurrentWindow","defaultPath","title","buttonLabel","t","properties","filters","name","extensions","then","data","canceled","filename","exported","filetype","split","pop","html","content","language","ocd","outputFile","readFile","Notification","body","catch","err","error","runExportProcess","filePath"],"mappings":"AAAA,aAEA,MAAMA,KAAUC,QAAS,eAEnBC,OAAEA,QAAYD,QAAS,YACvBE,MAAWF,QAAS,kBACpBG,MAAW,IAAID,MACfE,OAAWH,OAAOG,OAClBC,OAAWL,QAAS,UACpBM,eAAiBN,QAAS,mBAC1BO,OAAWP,QAAS,UACpBQ,GAAQR,QAAS,YACjBS,IAAST,QAAS,gBAGxBU,QAAQC,WAAa,SAAUC,GAE9B,MAAMC,EAAaV,MAAMW,IAAI,cAE7BV,OAAOW,eAAed,OAAOe,mBAAoB,CAEhDC,YAAa,GAAGJ,KAAcD,EAAKM,QACnCC,YAAapB,KAAKqB,EAAE,2BAA4B,eAChDC,WAAY,CAAE,gBACV,mBAEJC,QAAS,CACP,CAAEC,KAAOxB,KAAKqB,EAAE,yBAA0B,QACzCI,WAAY,CAAC,SAEd,CAAED,KAAOxB,KAAKqB,EAAE,uBAAwB,YACvCI,WAAY,CAAC,OAEd,CAAED,KAAOxB,KAAKqB,EAAE,wBAAyB,QACxCI,WAAY,CAAC,WAIfC,KAAMC,KAEe,IAAlBA,EAAKC,UAMV,SAA2BC,GAE1B,IAAIC,EACHC,EAED,OAAQF,EAASG,MAAM,KAAKC,OAE3B,IAAK,OAEJ,IAAIC,EAAO5B,OAAQO,EAAKsB,SAExBL,EAAWtB,OAAQ,8BAA8BR,KAAKoC,kDAAkDvB,EAAKM,6BAA6Be,kBAAsB,CAACG,KAAK,IAEtKN,EAAW,OAEZ,MAEA,IAAK,MAEJD,EAAWvB,eAAgBM,EAAKsB,SAChCJ,EAAW,OAEZ,MAEA,QAECD,EAAWjB,EAAKsB,QAChBJ,EAAW,WAGbtB,GAAG6B,WAAWT,EAAUC,GACvBJ,KAAK,IAAMjB,GAAG8B,SAASV,EAAU,SACjCH,KAAMC,IAEmB,IAAIa,aAAa,yBAA0B,CAEnEC,KAAMzC,KAAKqB,EAAE,+BAAgC,uDAAwD,CAACF,MAAON,EAAKM,MAAOY,SAAUA,QAIpIW,MAAMC,IAENjC,IAAIkC,MAAOD,KA9CXE,CAAkBlB,EAAKmB","file":"../export.min.js","sourcesContent":["'use strict'\n\nconst i18n\t\t\t\t= require( './i18n.min' )\n\nconst { remote }\t\t= require( 'electron' )\nconst Store\t\t\t\t= require( 'electron-store' )\nconst store\t\t\t\t= new Store()\nconst dialog\t\t\t= remote.dialog\nconst marked\t\t\t= require( 'marked' )\nconst removeMarkdown\t= require( 'remove-markdown' )\nconst pretty\t\t\t= require( 'pretty' )\nconst fs\t\t\t\t= require( 'fs-extra' )\nconst log\t\t\t\t= require( 'electron-log' )\n\n\nexports.exportNote = function( note ) {\n\t\n\tconst exportPath = store.get('exportPath')\n\t\n\tdialog.showSaveDialog(remote.getCurrentWindow(), {\n\t\t\t\n\t\tdefaultPath: `${exportPath}/${note.title}`,\n\t\tbuttonLabel: i18n.t('app:dialog.button.export', 'Export Note'),\n\t\tproperties: [\t'openDirectory',\n\t\t\t\t\t\t'createDirectory'\n\t\t\t\t\t],\n\t\tfilters: [\n\t\t\t\t{\tname:\t\ti18n.t('app:dialog.format.html', 'html'),\n\t\t\t\t\textensions:\t['html']\n\t\t\t\t},\n\t\t\t\t{\tname:\t\ti18n.t('app:dialog.format.md', 'markdown'),\n\t\t\t\t\textensions:\t['md']\n\t\t\t\t},\n\t\t\t\t{\tname:\t\ti18n.t('app:dialog.format.txt', 'text'),\n\t\t\t\t\textensions:\t['txt']\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t).then((data) =>{\n\t\t\n\t\tif( data.canceled === false ) {\n\t\t\t\n\t\t\trunExportProcess( data.filePath )\n\t\t}\n\t})\n\t\n\tfunction runExportProcess( filename ) {\n\t\t\n\t\tlet exported,\n\t\t\tfiletype\n\t\t\n\t\tswitch( filename.split('.').pop() ) {\n\t\t\t\n\t\t\tcase 'html':\n\t\t\t\t\n\t\t\t\tlet html = marked( note.content )\n\t\t\t\t\n\t\t\t\texported = pretty( `<!doctype html><html lang=\"${i18n.language}\"><head><meta charset=\"utf-8\" /><title>${note.title}</title></head><body>${html}</body></html>`, {ocd: true} )\n\t\t\t\t\n\t\t\t\tfiletype = 'html'\n\t\t\t\t\n\t\t\tbreak\n\t\t\t\n\t\t\tcase 'txt':\n\t\t\t\t\n\t\t\t\texported = removeMarkdown( note.content )\n\t\t\t\tfiletype = 'text'\n\t\t\t\n\t\t\tbreak\n\t\t\t\n\t\t\tdefault: //markdown\n\t\t\t\t\n\t\t\t\texported = note.content\n\t\t\t\tfiletype = 'markdown'\n\t\t}\n\t\t\n\t\tfs.outputFile(filename, exported)\n\t\t.then(() => fs.readFile(filename, 'utf8'))\n\t\t.then((data) => {\n\t\t\t\n\t\t\tlet exportNotification = new Notification('Nextcloud Notes Client', {\n\t\t\t\t\n\t\t\t\tbody: i18n.t('app:notification.export.text', 'The note {{title}} has been exported as {{filetype}}', {title: note.title, filetype: filetype})\n\t\t\t})\n\t\t})\n\t\t\n\t\t.catch(err => {\n\t\t\t\n\t\t\tlog.error( err )\n\t\t})\n\t}\n}\n"]}