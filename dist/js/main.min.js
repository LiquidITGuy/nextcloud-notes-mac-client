"use strict";const{app:app,BrowserWindow:BrowserWindow,ipcMain:ipcMain,protocol:protocol,systemPreferences:systemPreferences,webContents:webContents}=require("electron"),url=require("url"),path=require("path"),dialog=require("electron").dialog,Store=require("electron-store"),log=require("electron-log"),marked=require("marked"),removeMarkdown=require("remove-markdown");let win,loginFlow,prefs=null,store=new Store({name:"config",defaults:{windowBounds:{width:800,height:600,x:0,y:0},loginCredentials:{server:"",username:"",password:""},appInterface:{sidebar:null,selected:null,categories:!0},appSettings:{sortby:"modified",orderby:"desc",zoom:"10",cursor:"start",spellcheck:!0,showcats:!0,ordercats:"asc"},categories:{selected:"##all##",list:null},exportPath:app.getPath("desktop")}});function createWindow(){let{x:e,y:o,width:n,height:i}=store.get("windowBounds"),r="appearance-based";function s(){store.set("windowBounds",win.getBounds())}r=systemPreferences.isDarkMode()?"dark":"light",(win=new BrowserWindow({show:!1,x:e,y:o,width:n,height:i,titleBarStyle:"hidden",minWidth:500,minHeight:372,vibrancy:r,webPreferences:{devTools:!0,preload:path.join(__dirname,"./preload.min.js"),nodeIntegration:!0},icon:path.join(__dirname,"../assets/icon/Icon.icns")})).setSheetOffset(23),win.loadURL(url.format({pathname:path.join(__dirname,"../html/app.html"),protocol:"file:",slashes:!0})),win.once("ready-to-show",()=>{win.show()}),win.on("resize",s),win.on("move",s),win.on("closed",()=>{app.quit()}),win.webContents.on("did-fail-load",()=>{log.error("main window did not load")}),win.webContents.on("crashed",(e,o)=>{log.info("main window has crashed:"),log.error(e)}),win.on("unresponsive",()=>{log.info("main window is not responding…")}),win.on("responsive",()=>{log.info("main window is responding")}),require("./menu-app.min"),require("./menu-sidebar.min"),require("./menu-notes.min"),protocol.registerFileProtocol("nc",e=>{const o=e.url.split("&"),n=o[1].replace("user:",""),i=o[2].replace("password:","");store.set("loginCredentials.username",n),store.set("loginCredentials.password",i),loginFlow.close(),win.webContents.send("close-login-modal","close-login-modal"),win.webContents.send("reload-sidebar","login")},e=>{e&&log.error("Failed to register nc protocol")})}app.on("ready",createWindow),process.on("uncaughtException",(e,o)=>{log.error(`caught exception: ${e}`),log.info(`exception origin: ${o}`)}),ipcMain.on("loginflow",(e,o)=>{(loginFlow=new BrowserWindow({width:800,height:600,resizable:!1,minimizable:!1,maximizable:!1,show:!1,titleBarStyle:"hidden",backgroundColor:"#0082c9",webPreferences:{devTools:!0,nodeIntegration:!1}})).loadURL(o+"/index.php/login/flow",{userAgent:"Nextcloud Notes Client - Macintosh",extraHeaders:"OCS-APIRequest: true"}),loginFlow.once("ready-to-show",()=>{loginFlow.show()}),loginFlow.webContents.on("did-fail-load",()=>{log.error("loginflow window did not load")}),loginFlow.webContents.on("crashed",(e,o)=>{log.info("loginflow window has crashed:"),log.error(e)}),loginFlow.on("unresponsive",()=>{log.info("loginflow window is not responding…")}),loginFlow.on("responsive",()=>{log.info("loginflow window is responding")})}),app.on("open-prefs",()=>{if(null===prefs){let e="appearance-based";e=systemPreferences.isDarkMode()?"dark":"light",(prefs=new BrowserWindow({width:548,height:528,resizable:!1,minimizable:!1,maximizable:!1,show:!1,titleBarStyle:"hidden",vibrancy:e,webPreferences:{devTools:!0,preload:path.join(__dirname,"./preload.min.js"),nodeIntegration:!0}})).loadURL(url.format({pathname:path.join(__dirname,"../html/prefs.html"),protocol:"file:",slashes:!0})),prefs.once("ready-to-show",()=>{prefs.show()}),prefs.webContents.on("did-fail-load",()=>{log.error("prefs window did not load")}),prefs.webContents.on("crashed",(e,o)=>{log.info("prefs window has crashed:"),log.error(e)}),prefs.on("unresponsive",()=>{log.info("prefs window is not responding…")}),prefs.on("responsive",()=>{log.info("prefs window is responding")}),prefs.on("close",()=>{prefs=null})}}),ipcMain.on("new-category",(e,o)=>{win.webContents.send("context-category",o)}),ipcMain.on("reload-sidebar",()=>{win.webContents.send("reload-sidebar",null)}),ipcMain.on("set-zoom-slider",(e,o)=>{win.webContents.send("set-zoom-slider",o)}),ipcMain.on("spellcheck",(e,o)=>{win.webContents.send("spellcheck",o)}),ipcMain.on("showcats",(e,o)=>{win.webContents.send("showcats",o)}),ipcMain.on("update-theme",(e,o)=>{webContents.getAllWebContents().forEach(e=>{e.send("set-theme",o)})}),ipcMain.on("error-in-render",(function(e,o){log.error("exception in render process:"),log.info(o)}));
//# sourceMappingURL=maps/main.min.js.map
