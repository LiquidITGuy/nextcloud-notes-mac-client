"use strict";const{app:app,BrowserWindow:BrowserWindow,ipcMain:ipcMain,protocol:protocol,systemPreferences:systemPreferences}=require("electron"),url=require("url"),path=require("path"),dialog=require("electron").dialog,Store=require("electron-store"),marked=require("marked"),removeMarkdown=require("remove-markdown");let win,loginFlow,prefs=null,store=new Store({name:"config",defaults:{windowBounds:{width:800,height:600,x:0,y:0},loginCredentials:{server:"",username:"",password:""},appInterface:{sidebar:null,selected:null},appSettings:{sortby:"modified",orderby:"desc",zoom:"10",cursor:"start",spellcheck:!0},exportPath:app.getPath("desktop")}});function createWindow(){let{x:e,y:o,width:n,height:r}=store.get("windowBounds"),i=systemPreferences.isDarkMode()?"#393837":"#ededed";function s(){store.set("windowBounds",win.getBounds())}(win=new BrowserWindow({show:!1,x:e,y:o,width:n,height:r,titleBarStyle:"hidden",minWidth:500,minHeight:372,backgroundColor:i,webPreferences:{devTools:!1,preload:path.join(__dirname,"./preload.min.js"),nodeIntegration:!0},icon:path.join(__dirname,"../assets/icon/Icon.icns")})).setSheetOffset(24),win.loadURL(url.format({pathname:path.join(__dirname,"../html/app.html"),protocol:"file:",slashes:!0})),win.once("ready-to-show",()=>{win.show()}),win.on("resize",s),win.on("move",s),win.on("closed",()=>{app.quit()}),require("./menu-app.min"),require("./menu-sidebar.min"),protocol.registerFileProtocol("nc",(e,o)=>{const n=e.url.split("&"),r=n[1].replace("user:",""),i=n[2].replace("password:","");store.set("loginCredentials.username",r),store.set("loginCredentials.password",i),loginFlow.close(),win.webContents.send("close-login-modal","close-login-modal"),win.reload()},e=>{e&&console.error("Failed to register protocol")})}app.on("ready",createWindow),ipcMain.on("loginflow",(e,o)=>{(loginFlow=new BrowserWindow({width:800,height:600,resizable:!1,minimizable:!1,maximizable:!1,show:!1,titleBarStyle:"hidden",backgroundColor:"#0082c9",webPreferences:{devTools:!1,nodeIntegration:!1}})).loadURL(o+"/index.php/login/flow",{userAgent:"Nextcloud Notes Client - Macintosh",extraHeaders:"OCS-APIRequest: true"}),loginFlow.once("ready-to-show",()=>{loginFlow.show()})}),app.on("open-prefs",()=>{if(null===prefs){let e=systemPreferences.isDarkMode()?"#393837":"#ededed";(prefs=new BrowserWindow({width:548,height:330,resizable:!1,minimizable:!1,maximizable:!1,show:!1,backgroundColor:e,webPreferences:{devTools:!1,preload:path.join(__dirname,"./preload.min.js"),nodeIntegration:!0}})).loadURL(url.format({pathname:path.join(__dirname,"../html/prefs.html"),protocol:"file:",slashes:!0})),prefs.once("ready-to-show",()=>{prefs.show()}),prefs.on("close",()=>{prefs=null})}}),ipcMain.on("reload-sidebar",()=>{win.webContents.send("reload-sidebar",null)}),ipcMain.on("set-zoom-slider",(e,o)=>{win.webContents.send("set-zoom-slider",o)}),ipcMain.on("spellcheck",(e,o)=>{win.webContents.send("spellcheck",o)});
//# sourceMappingURL=maps/main.min.js.map
