"use strict";const{app:app,BrowserWindow:BrowserWindow,ipcMain:ipcMain,protocol:protocol,webContents:webContents}=require("electron"),url=require("url"),path=require("path"),dialog=require("electron").dialog,Store=require("electron-store"),log=require("electron-log"),marked=require("marked"),removeMarkdown=require("remove-markdown");let win,loginFlow,prefs=null,store=new Store({name:"config",defaults:{windowBounds:{width:1e3,height:680,x:0,y:0},loginCredentials:{server:"",username:"",password:""},appInterface:{sidebar:null,selected:null,categories:!0},appSettings:{sortby:"modified",orderby:"desc",zoom:"10",cursor:"start",spellcheck:!0,showcats:!0,ordercats:"asc",catcount:!1,nocertificate:!1,stopwords:!1,stemming:!1},categories:{selected:"##all##",list:null},exportPath:app.getPath("desktop")}});function createWindow(){let{x:e,y:o,width:n,height:i}=store.get("windowBounds");function r(){store.set("windowBounds",win.getBounds())}(win=new BrowserWindow({show:!1,x:e,y:o,width:n,height:i,titleBarStyle:"hidden",minWidth:800,minHeight:372,vibrancy:"sidebar",webPreferences:{devTools:!0,preload:path.join(__dirname,"./preload.min.js"),nodeIntegration:!0},icon:path.join(__dirname,"../assets/icon/Icon.icns")})).setSheetOffset(23),win.loadURL(url.format({pathname:path.join(__dirname,"../html/app.html"),protocol:"file:",slashes:!0})),win.once("ready-to-show",()=>{win.show()}),win.on("resize",r),win.on("move",r),win.on("closed",()=>{app.quit()}),win.webContents.on("did-fail-load",()=>{log.error("main window did not load")}),win.webContents.on("crashed",(e,o)=>{log.info("main window has crashed:"),log.error(e)}),win.on("unresponsive",()=>{log.info("main window is not responding…")}),win.on("responsive",()=>{log.info("main window is responding")}),protocol.registerFileProtocol("nc",e=>{if(e.url){const o=e.url.split("&"),n=o[1].replace("user:",""),i=o[2].replace("password:","");store.set("loginCredentials.username",n),store.set("loginCredentials.password",i),loginFlow.close(),win.webContents.send("close-login-modal","close-login-modal"),win.webContents.send("reload-sidebar","login")}else log.error("Failed to register nc protocol")}),require("./menu-app.min"),require("./menu-sidebar.min"),require("./menu-notes.min")}app.on("ready",createWindow),app.on("certificate-error",(e,o,n,i,r,t)=>{if(store.get("appSettings.nocertificate"))log.info("certificate ignored"),e.preventDefault(),t(!0);else{const e=require("./i18n.min");log.error(i),t(!1);let o=store.get("loginCredentials.server");dialog.showErrorBox(e.t("main:dialog.error.cert.title","Your connection is not private"),`${i}\n\n`+e.t("main:dialog.error.cert.text",{server:o}))}}),process.on("uncaughtException",(e,o)=>{log.error(`caught exception: ${e}`),log.info(`exception origin: ${o}`)}),ipcMain.on("loginflow",(e,o)=>{(loginFlow=new BrowserWindow({width:800,height:600,resizable:!1,minimizable:!1,maximizable:!1,show:!1,titleBarStyle:"hidden",backgroundColor:"#0082c9",webPreferences:{devTools:!0,nodeIntegration:!1}})).loadURL(o+"/index.php/login/flow",{userAgent:"Nextcloud Notes Client - Macintosh",extraHeaders:"OCS-APIRequest: true"}),loginFlow.once("ready-to-show",()=>{loginFlow.show()}),loginFlow.webContents.on("did-fail-load",()=>{log.error("loginflow window did not load")}),loginFlow.webContents.on("crashed",(e,o)=>{log.info("loginflow window has crashed:"),log.error(e)}),loginFlow.on("unresponsive",()=>{log.info("loginflow window is not responding…")}),loginFlow.on("responsive",()=>{log.info("loginflow window is responding")})}),app.on("open-prefs",()=>{null===prefs&&((prefs=new BrowserWindow({width:548,height:454,resizable:!1,minimizable:!1,maximizable:!1,show:!1,titleBarStyle:"hidden",vibrancy:"under-window",webPreferences:{devTools:!0,preload:path.join(__dirname,"./preload.min.js"),nodeIntegration:!0}})).loadURL(url.format({pathname:path.join(__dirname,"../html/prefs.html"),protocol:"file:",slashes:!0})),prefs.once("ready-to-show",()=>{prefs.show()}),prefs.webContents.on("did-fail-load",()=>{log.error("prefs window did not load")}),prefs.webContents.on("crashed",(e,o)=>{log.info("prefs window has crashed:"),log.error(e)}),prefs.on("unresponsive",()=>{log.info("prefs window is not responding…")}),prefs.on("responsive",()=>{log.info("prefs window is responding")}),prefs.on("close",()=>{prefs=null}))}),ipcMain.on("new-category",(e,o)=>{win.webContents.send("context-category",o)}),ipcMain.on("reload-sidebar",(e,o)=>{win.webContents.send("reload-sidebar",o)}),ipcMain.on("set-zoom-slider",(e,o)=>{win.webContents.send("set-zoom-slider",o)}),ipcMain.on("update-theme",(e,o)=>{webContents.getAllWebContents().forEach(e=>{e.send("set-theme",o)})}),ipcMain.on("error-in-render",(function(e,o){log.error("exception in render process:"),log.info(o)}));
//# sourceMappingURL=maps/main.min.js.map
